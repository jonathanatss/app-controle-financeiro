<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Pessoal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles/style.css"> 
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’° Controle Financeiro Pessoal</h1>
            <p>Gerencie suas finanÃ§as de forma inteligente e eficiente</p>

            <div id="authSection">
                <div id="userInfo" style="display: none;">
                    <p>Logado como: <strong id="userEmailDisplay"></strong></p>
                    <button class="btn btn-secondary" onclick="handleLogout()">Logout</button>
                </div>
        
                <div id="loginRegisterForms"> 
                    <h4 id="authTitle">Acesse sua Conta ou Cadastre-se</h4>
                    
                    <form id="loginForm" style="display: block;"> 
                        <h5>Login</h5>
                        <div class="form-group">
                            <label for="loginEmail">Email:</label>
                            <input type="email" id="loginEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Senha:</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn">Entrar</button>
                        <p class="auth-switch-link">
                            <a href="#" id="switchToRegister">NÃ£o tem uma conta? Cadastre-se</a>
                        </p>
                    </form>
    
                    <form id="registerForm" style="display: none;"> 
                        <h5>Novo Cadastro</h5>
                        <div class="form-group">
                            <label for="registerEmail">Email:</label>
                            <input type="email" id="registerEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">Senha (mÃ­n. 6 caracteres):</label>
                            <input type="password" id="registerPassword" required minlength="6">
                        </div>
                         <div class="form-group">
                            <label for="registerPasswordConfirm">Confirmar Senha:</label>
                            <input type="password" id="registerPasswordConfirm" required minlength="6">
                        </div>
                        <button type="submit" class="btn btn-success">Cadastrar</button>
                        <p class="auth-switch-link">
                            <a href="#" id="switchToLogin">JÃ¡ tem uma conta? FaÃ§a Login</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'dashboard')">ğŸ“Š Dashboard</button>
            <button class="tab" onclick="openTab(event, 'receitas')">ğŸ’° Receitas</button>
            <button class="tab" onclick="openTab(event, 'despesas')">ğŸ’¸ Despesas</button>
            <button class="tab" onclick="openTab(event, 'investimentos')">ğŸ“ˆ Investimentos</button>
            <button class="tab" onclick="openTab(event, 'reserva')">ğŸ›¡ï¸ Reserva</button>
            <button class="tab" onclick="openTab(event, 'configuracoes')">âš™ï¸ ConfiguraÃ§Ãµes</button> 
            <button class="tab" onclick="openTab(event, 'dados')">ğŸ’¾ Dados</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="dashboard">
                <div class="card receita"><h3>ğŸ’° Receitas do MÃªs</h3><div class="valor" id="totalReceitas">R$ 0,00</div><small>Total de entradas</small></div>
                <div class="card despesa"><h3>ğŸ’¸ Despesas do MÃªs</h3><div class="valor" id="totalDespesas">R$ 0,00</div><small>Total de saÃ­das</small></div>
                <div class="card"><h3>ğŸ“Š Saldo do MÃªs</h3><div class="valor" id="saldoMes">R$ 0,00</div><small>Receitas - Despesas</small></div>
                <div class="card investimento"><h3>ğŸ“ˆ Total Investido</h3><div class="valor" id="totalInvestimentos">R$ 0,00</div><small>PatrimÃ´nio em investimentos</small></div>
                <div class="card reserva"><h3>ğŸ›¡ï¸ Reserva de EmergÃªncia</h3><div class="valor" id="reservaAtual">R$ 0,00</div><small id="statusReserva">Status da reserva</small></div>
                <div class="card"><h3>ğŸ¯ Meta da Reserva</h3><div class="valor" id="metaReserva">R$ 0,00</div><small>6 meses de gastos essenciais</small><div class="progress-bar"><div class="progress-fill" id="progressReserva" style="width: 0%"></div></div></div>
            </div>
            <div class="form-section">
                <h3>ğŸ“‹ Ãšltimas TransaÃ§Ãµes</h3>
                <div class="lista-transacoes"><table class="table" id="tabelaTransacoes"><thead><tr><th>Data</th><th>Tipo</th><th>DescriÃ§Ã£o</th><th>Categoria</th><th>Valor</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>

        <div id="receitas" class="tab-content">
            <div class="form-section">
                <h3 id="formReceitaTitulo">ğŸ’° Adicionar Receita</h3>
                <form id="formReceita">
                    <div class="form-row">
                        <div class="form-group"><label for="dataReceita">Data</label><input type="date" id="dataReceita" required></div>
                        <div class="form-group"><label for="descricaoReceita">DescriÃ§Ã£o</label><input type="text" id="descricaoReceita" placeholder="Ex: SalÃ¡rio, Freelance..." required></div>
                        <div class="form-group">
                            <label for="categoriaReceita">Categoria</label>
                            <select id="categoriaReceita" required><option value="">Selecione...</option></select>
                        </div>
                        <div class="form-group"><label for="valorReceita">Valor (R$)</label><input type="number" id="valorReceita" step="0.01" min="0.01" placeholder="0,00" required></div>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-success" id="btnSubmitReceita">Adicionar Receita</button>
                        <button type="button" class="btn btn-secondary" id="btnCancelarEdicaoReceita" style="display:none;" onclick="cancelarEdicao('receita')">Cancelar EdiÃ§Ã£o</button>
                    </div>
                </form>
            </div>
            <div class="form-section"><h3>ğŸ“Š Lista de Receitas (<span id="contadorReceitas">0</span>)</h3><table class="table"><thead><tr><th>Data</th><th>DescriÃ§Ã£o</th><th>Categoria</th><th>Valor</th><th>AÃ§Ãµes</th></tr></thead><tbody id="listaReceitas"></tbody></table></div>
        </div>

        <div id="despesas" class="tab-content">
            <div class="form-section">
                <h3 id="formDespesaTitulo">ğŸ’¸ Adicionar Despesa</h3>
                <form id="formDespesa">
                    <div class="form-row">
                        <div class="form-group"><label for="dataDespesa">Data</label><input type="date" id="dataDespesa" required></div>
                        <div class="form-group"><label for="descricaoDespesa">DescriÃ§Ã£o</label><input type="text" id="descricaoDespesa" placeholder="Ex: Supermercado, CombustÃ­vel..." required></div>
                        <div class="form-group">
                            <label for="categoriaDespesa">Categoria</label>
                            <select id="categoriaDespesa" required><option value="">Selecione...</option></select>
                        </div>
                        <div class="form-group"><label for="valorDespesa">Valor (R$)</label><input type="number" id="valorDespesa" step="0.01" min="0.01" placeholder="0,00" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label for="tipoDespesa">Tipo</label><select id="tipoDespesa" required><option value="">Selecione...</option><option value="Fixo">Fixo</option><option value="VariÃ¡vel">VariÃ¡vel</option></select></div>
                        <div class="form-group"><label for="pagamentoDespesa">Forma de Pagamento</label><select id="pagamentoDespesa" required><option value="">Selecione...</option><option value="Dinheiro">ğŸ’µ Dinheiro</option><option value="CartÃ£o DÃ©bito">ğŸ’³ CartÃ£o DÃ©bito</option><option value="CartÃ£o CrÃ©dito">ğŸ’³ CartÃ£o CrÃ©dito</option><option value="PIX">ğŸ“± PIX</option><option value="TransferÃªncia">ğŸ¦ TransferÃªncia</option></select></div>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-danger" id="btnSubmitDespesa">Adicionar Despesa</button>
                        <button type="button" class="btn btn-secondary" id="btnCancelarEdicaoDespesa" style="display:none;" onclick="cancelarEdicao('despesa')">Cancelar EdiÃ§Ã£o</button>
                    </div>
                </form>
            </div>
            <div class="form-section"><h3>ğŸ“Š Lista de Despesas (<span id="contadorDespesas">0</span>)</h3><table class="table"><thead><tr><th>Data</th><th>DescriÃ§Ã£o</th><th>Categoria</th><th>Tipo</th><th>Pagamento</th><th>Valor</th><th>AÃ§Ãµes</th></tr></thead><tbody id="listaDespesas"></tbody></table></div>
        </div>

        <div id="investimentos" class="tab-content">
              <div class="form-section">
                <h3 id="formInvestimentoTitulo">ğŸ“ˆ Adicionar Investimento</h3>
                <form id="formInvestimento">
                    <div class="form-row">
                        <div class="form-group"><label for="dataInvestimento">Data da AplicaÃ§Ã£o</label><input type="date" id="dataInvestimento" required></div>
                        <div class="form-group"><label for="tipoInvestimento">Tipo de Investimento</label><select id="tipoInvestimento" required><option value="">Selecione...</option><option value="PoupanÃ§a">ğŸ’° PoupanÃ§a</option><option value="CDB">ğŸ¦ CDB</option><option value="Tesouro Direto">ğŸ›ï¸ Tesouro Direto</option><option value="AÃ§Ãµes">ğŸ“Š AÃ§Ãµes</option><option value="Fundos">ğŸ“ˆ Fundos de Investimento</option><option value="Outros">ğŸ“¦ Outros</option></select></div>
                        <div class="form-group"><label for="instituicaoInvestimento">InstituiÃ§Ã£o</label><input type="text" id="instituicaoInvestimento" placeholder="Ex: Banco, Corretora..." required></div>
                        <div class="form-group"><label for="valorInvestimento">Valor Aplicado (R$)</label><input type="number" id="valorInvestimento" step="0.01" min="0.01" placeholder="0,00" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label for="rentabilidadeInvestimento">Rentabilidade Esperada (% a.a.)</label><input type="number" id="rentabilidadeInvestimento" step="0.01" min="0" placeholder="0,00"></div>
                        <div class="form-group"><label for="valorAtualInvestimento">Valor Atual (R$)</label><input type="number" id="valorAtualInvestimento" step="0.01" min="0" placeholder="0,00"><small>Deixe em branco ou 0 para usar o valor aplicado.</small></div>
                    </div>
                     <div class="form-buttons">
                        <button type="submit" class="btn" id="btnSubmitInvestimento" style="background: linear-gradient(135deg, #6f42c1 0%, #532e8f 100%);">Adicionar Investimento</button>
                        <button type="button" class="btn btn-secondary" id="btnCancelarEdicaoInvestimento" style="display:none;" onclick="cancelarEdicao('investimento')">Cancelar EdiÃ§Ã£o</button>
                    </div>
                </form>
            </div>
            <div class="form-section"><h3>ğŸ“Š Carteira de Investimentos (<span id="contadorInvestimentos">0</span>)</h3><table class="table"><thead><tr><th>Data</th><th>Tipo</th><th>InstituiÃ§Ã£o</th><th>Valor Aplicado</th><th>Valor Atual</th><th>Rentabilidade (% a.a.)</th><th>Rendimento (R$)</th><th>AÃ§Ãµes</th></tr></thead><tbody id="listaInvestimentos"></tbody></table></div>
        </div>

        <div id="reserva" class="tab-content">
            <div class="dashboard"><div class="card reserva"><h3>ğŸ›¡ï¸ Reserva Atual</h3><div class="valor" id="reservaAtualPage">R$ 0,00</div><small>Valor disponÃ­vel para emergÃªncias</small></div><div class="card"><h3>ğŸ¯ Meta de Reserva</h3><div class="valor" id="metaReservaPage">R$ 0,00</div><small>Recomendado: 6 meses de gastos essenciais</small></div><div class="card"><h3>ğŸ“Š Progresso</h3><div class="valor" id="percentualReserva">0%</div><small>Da meta alcanÃ§ada</small><div class="progress-bar"><div class="progress-fill" id="progressReservaPage" style="width: 0%"></div></div></div><div class="card"><h3>ğŸ’° Falta para Meta</h3><div class="valor" id="faltaReserva">R$ 0,00</div><small>Para completar a reserva de 6 meses</small></div></div>
            <div class="form-section"><h3>ğŸ”§ Configurar Reserva de EmergÃªncia</h3><form id="formReserva" onsubmit="configurarReserva(event)"><div class="form-row"><div class="form-group"><label for="valorReservaAtual">Valor Atual Investido na Reserva (R$)</label><input type="number" id="valorReservaAtual" step="0.01" min="0" placeholder="0,00"></div><div class="form-group"><label for="gastosEssenciais">Seus Gastos Essenciais Mensais (R$)</label><input type="number" id="gastosEssenciais" step="0.01" min="0" placeholder="Ex: Moradia, AlimentaÃ§Ã£o"><small>Usado para calcular sua meta de 6 meses.</small></div></div><button type="submit" class="btn">Salvar ConfiguraÃ§Ã£o da Reserva</button></form></div>
            <div class="form-section"><h3>ğŸ“‹ AnÃ¡lise da Reserva</h3><div id="analiseReserva"><p><strong>Status da Reserva:</strong> <span id="statusReservaTexto">Configure os valores</span></p><p><strong>Meses de ProteÃ§Ã£o Atuais:</strong> <span id="mesesProtecao">0 meses</span></p><p><strong>RecomendaÃ§Ã£o:</strong> <span id="recomendacao">Configure sua reserva para anÃ¡lise.</span></p></div></div>
        </div>

        <div id="configuracoes" class="tab-content">
            <div class="form-section">
                <h3>âš™ï¸ Gerenciar Categorias</h3>
                <div class="category-management-section">
                    <div class="category-column">
                        <h4>Categorias de Receita</h4>
                        <form class="add-category-form" onsubmit="event.preventDefault(); adicionarNovaCategoria('receita');">
                            <input type="text" id="inputNovaCategoriaReceita" placeholder="Nova categoria de receita">
                            <button type="submit" class="btn btn-success">Adicionar</button>
                        </form>
                        <ul id="listaCategoriasReceita" class="category-list"></ul>
                    </div>
                    <div class="category-column">
                        <h4>Categorias de Despesa</h4>
                        <form class="add-category-form" onsubmit="event.preventDefault(); adicionarNovaCategoria('despesa');">
                            <input type="text" id="inputNovaCategoriaDespesa" placeholder="Nova categoria de despesa">
                            <button type="submit" class="btn btn-success">Adicionar</button>
                        </form>
                        <ul id="listaCategoriasDespesa" class="category-list"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="dados" class="tab-content">
            <div class="form-section">
                <h3><i class="fas fa-database"></i> Backup e RestauraÃ§Ã£o de Dados</h3>
                <p style="margin-bottom:15px;">Gerencie os dados da sua aplicaÃ§Ã£o. FaÃ§a backups regulares!</p>
                <div class="form-row" style="gap: 20px;">
                    <div class="form-group" style="align-items: center;">
                        <button class="btn btn-success" onclick="exportarDados()" style="width:100%; max-width:250px;"><i class="fas fa-download"></i> Exportar Dados</button>
                        <small>Baixar todos os dados em arquivo JSON.</small>
                    </div>
                    <div class="form-group" style="align-items: center;">
                        <input type="file" id="arquivoImport" accept=".json" style="display:none" onchange="importarDados(event)">
                        <button class="btn" style="background-color:#007bff; width:100%; max-width:250px;" onclick="document.getElementById('arquivoImport').click()"><i class="fas fa-upload"></i> Importar de Arquivo</button>
                        <small>Carregar dados de um arquivo JSON.</small>
                    </div>
                </div>
                <div class="form-row" style="gap: 20px; margin-top:20px;">
                     <div class="form-group" style="align-items: center;">
                        <button class="btn" style="background-color:#5a6268; width:100%; max-width:250px;" onclick="copiarDadosAreaTransferencia()"><i class="fas fa-copy"></i> Copiar Dados (JSON)</button>
                        <small>Copiar dados para Ã¡rea de transferÃªncia.</small>
                    </div>
                    <div class="form-group" style="align-items: center;">
                        <button class="btn" style="background-color:#5a6268; width:100%; max-width:250px;" onclick="mostrarAreaImportacao()"><i class="fas fa-paste"></i> Colar/Importar Texto</button>
                        <small>Importar dados colando o texto JSON.</small>
                    </div>
                </div>

                <div id="areaImportacaoTexto" style="display:none; margin-top:25px; padding-top:20px; border-top:1px solid #eee;">
                    <h4>Importar Dados via Texto JSON</h4>
                    <div class="form-group">
                        <textarea id="textoImportacao" placeholder="Cole o conteÃºdo JSON aqui..." style="width:100%;height:150px;padding:10px;border:1px solid #ccc;border-radius:5px;font-family:monospace;font-size:0.9em;resize:vertical; margin-bottom:10px;"></textarea>
                    </div>
                    <div class="form-buttons" style="justify-content: flex-start;">
                        <button class="btn btn-success" onclick="importarViaTexto()">Importar Texto</button>
                        <button class="btn btn-secondary" onclick="ocultarAreaImportacao()">Cancelar</button>
                    </div>
                </div>
                <div style="margin-top:30px; padding-top:20px; border-top:1px dashed #ccc; text-align:center;">
                    <button class="btn btn-danger" onclick="limparTodosDados()" style="min-width:250px;"><i class="fas fa-trash-alt"></i> Limpar Todos os Dados da AplicaÃ§Ã£o</button>
                    <p><small style="color:#dc3545;">AtenÃ§Ã£o: Esta aÃ§Ã£o Ã© irreversÃ­vel e removerÃ¡ todos os seus dados.</small></p>
                </div>
            </div>
            <div class="form-section"><h3>ğŸ“Š EstatÃ­sticas Gerais</h3><div class="dashboard"><div class="card"><h3>ğŸ’° Total Receitas</h3><div class="valor" id="totalReceitasCadastradas">0</div><small>Registros</small></div><div class="card"><h3>ğŸ’¸ Total Despesas</h3><div class="valor" id="totalDespesasCadastradas">0</div><small>Registros</small></div><div class="card"><h3>ğŸ“ˆ Total Investimentos</h3><div class="valor" id="totalInvestimentosCadastrados">0</div><small>Registros</small></div><div class="card"><h3>ğŸ“… Primeiro Registro</h3><div class="valor" id="primeiroRegistro">-</div><small>Data mais antiga</small></div></div></div>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <p id="modalMessageText"></p>
            <div class="form-buttons">
                <button id="modalConfirmButton" class="btn btn-danger">Confirmar</button>
                <button id="modalCancelButton" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    
    <script>
        // SEU firebaseConfig (verifique se storageBucket estÃ¡ correto, geralmente Ã© .appspot.com)
        const firebaseConfig = {
            apiKey: "AIzaSyDyYvLnrjapH_yNZESacoafPsnyOv5F-NY",
            authDomain: "controle-financeiro-6d709.firebaseapp.com",
            projectId: "controle-financeiro-6d709",
            storageBucket: "controle-financeiro-6d709.appspot.com", // Geralmente Ã© .appspot.com
            messagingSenderId: "725015122446",
            appId: "1:725015122446:web:0cbe9146eadabc50f4a25f",
            measurementId: "G-3BJNLZNHLT" // Opcional
        };

        try {
            if (typeof firebase !== 'undefined' && typeof firebase.initializeApp === 'function') {
                firebase.initializeApp(firebaseConfig);
                window.auth = firebase.auth(); // Define auth globalmente
                console.log("Firebase inicializado (compat) e window.auth definido no index.html.");

                // Opcional: Inicializar Analytics se vocÃª realmente o usa e incluiu o SDK
                // if (typeof firebase.analytics === 'function') {
                //    const analytics = firebase.analytics();
                //    console.log("Firebase Analytics inicializado (compat).");
                // }
            } else {
                console.error("ERRO CRÃTICO: Firebase SDK (compatÃ­vel) nÃ£o carregado ANTES do script de inicializaÃ§Ã£o. Verifique os links <script> dos SDKs.");
                const authSectionDiv = document.getElementById('authSection');
                if(authSectionDiv) {
                    const errorDisplay = authSectionDiv.querySelector('#loginRegisterForms') || authSectionDiv;
                    errorDisplay.innerHTML = "<p style='color:red; text-align:center; padding:10px; background-color: rgba(255,0,0,0.1); border-radius:5px;'>Erro crÃ­tico: SDK do Firebase nÃ£o carregado. Verifique o console (F12).</p>";
                }
            }
        } catch (e) {
            console.error("Erro CRÃTICO ao inicializar o Firebase no index.html:", e);
            const authSectionDiv = document.getElementById('authSection');
            if(authSectionDiv) {
                const errorDisplay = authSectionDiv.querySelector('#loginRegisterForms') || authSectionDiv;
                errorDisplay.innerHTML = "<p style='color:red; text-align:center; padding:10px; background-color: rgba(255,0,0,0.1); border-radius:5px;'>Falha crÃ­tica ao inicializar Firebase. Verifique o console (F12).</p>";
            }
        }
    </script>

    <script src="../scripts/script.js"></script>
    </body>
</html>